<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="https://cdn.ckeditor.com/4.14.0/standard/ckeditor.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.css" integrity="sha512-3pIirOrwegjM6erE5gPSwkUzO+3cTjpnV9lexlNZqvupR64iZBnOOTiiLPb9M36zpMScbmUNIcHUqKD47M719g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>

<style>
    .ck-editor__editable_inline {
        min-height: 300px;
    }
    </style>
<body>
    <div style="padding: 20px">
        <h2>Cập nhật bài viết</h2>
        <br>
        <form>
            <div class="form-group">
              <label for="title">Tiêu đề</label>
              <input value="<%=infoBlog.title%>" type="text" class="form-control" id="title" placeholder="Nhập tiêu đề">
            </div>
    
            <div class="form-group">
              <label for="image">Hình ảnh</label>
              <input value = "<%=infoBlog.image%>" type="text" class="form-control" id="image" placeholder="Nhập link hình ảnh">
            </div>

            <div class="form-group">
                <label for="exampleFormControlSelect1">Danh mục</label>
                <select class="form-control" id="category">
                  <option value="2">Du lịch</option>
                  <option value="3">Blog</option>
                </select>
            </div>

            <div class="form-group">
                <label for="content">Nội dung bài viết</label>
                <div name= "editor" class="editor__editable_inline" id="editor" aria-placeholder=""></div>
            </div>

            <script>
                CKEDITOR.replace( 'editor' );
            </script>

            <button style="margin-top: 20px;"  type="submit" _blogID="<%=infoBlog._id %> " class="btn btn-primary update-blog">Cập nhật bài viết</button>
        </form>
    </div>
    
</body>
</html>
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
<script src="https://cdn.ckeditor.com/ckeditor5/34.1.0/classic/ckeditor.js"></script>

<script>

    $(document).ready(function(){

        let blogID = `<%=blogID%>`;

        $.ajax({
            url: `/blog/info/${blogID}`,
            method: 'GET',
            success: resp => {
                let infoBlog = resp.data;
                console.log({ resp });
                console.log({ infoBlog });
                if(!resp.error){
                    CKEDITOR.instances['editor'].setData(infoBlog.content);
                }else{
                    return toastr['error']('Thêm thất bại', 'Thông báo');
                }
            },
            error: err => console.log({ err })
        });

        $(document).on('click', '.update-blog', function(e) {
            e.preventDefault();

            let blogID = `<%=blogID%>`;

            let title       = $('#title').val().trim();
            let image 	    = $('#image').val().trim();
            let category 	= $('#category').val().trim();
            let content 	= CKEDITOR.instances['editor'].getData();

            console.log({ title, image, content, category });

            if(!title|| !image || !category){
                return toastr.info('Vui lòng nhập đủ!')
            } else{
                $.ajax({
                    url: `/blog/update/${blogID}`,
                    method: 'POST',
                    data: { title, image, content, category },
                    success: resp => {
                        console.log({ resp })
                        if(!resp.error){
                            toastr['success']('Cập nhật thành công', 'Thông báo');
                            let blogID = resp.data._id
                            location.reload();
                        }else{
                            return toastr['error']('Cập nhật thất bại', 'Thông báo');
                        }
                    },
                    error: err => console.log({ err })
                });
            }
        })
    })
    
</script>